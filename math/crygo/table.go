package crygo

import (
	"errors"
)

type replacer interface {
	replace(s0 uint32) (s1 uint32)
}

type replacer16x8 [16 * 8]byte

func newReplacer16x8(table []byte) (replacer, error) {

	if err := TableError(table); err != nil {
		return nil, err
	}

	r := new(replacer16x8)
	copy(r[:], table)

	return r, nil
}

func (this *replacer16x8) replace(s0 uint32) (s1 uint32) {
	return replace8(this[:], s0)
}

type replacer256x4 [256 * 4]byte

func newReplacer256x4(table []byte) (replacer, error) {

	if err := TableError(table); err != nil {
		return nil, err
	}

	t := new(replacer256x4)
	replace8_to_replace4(table, t[:])

	return t, nil
}

func (this *replacer256x4) replace(s0 uint32) (s1 uint32) {
	return replace4(this[:], s0)
}

func TableError(table []byte) error {

	if len(table) != 16*8 {
		return errors.New("wrong table len")
	}

	var x [16]int

	for i := 0; i < 8; i++ {

		// reset
		for j, _ := range x {
			x[j] = 0
		}

		for j := 0; j < 16; j++ {
			b := table[j]
			if (b >= 0) && (b < 16) {
				x[b]++
			} else {
				return errors.New("table: invalid value")
			}
		}

		for j, _ := range x {
			if x[j] != 1 {
				return errors.New("table wrong")
			}
		}

		table = table[16:]
	}

	return nil
}

//----------------------------------------------
// Идентификатор: id-GostR3411-94-TestParamSet

var Table1 = []byte{
	0x4, 0xA, 0x9, 0x2, 0xD, 0x8, 0x0, 0xE, 0x6, 0xB, 0x1, 0xC, 0x7, 0xF, 0x5, 0x3,
	0xE, 0xB, 0x4, 0xC, 0x6, 0xD, 0xF, 0xA, 0x2, 0x3, 0x8, 0x1, 0x0, 0x7, 0x5, 0x9,
	0x5, 0x8, 0x1, 0xD, 0xA, 0x3, 0x4, 0x2, 0xE, 0xF, 0xC, 0x7, 0x6, 0x0, 0x9, 0xB,
	0x7, 0xD, 0xA, 0x1, 0x0, 0x8, 0x9, 0xF, 0xE, 0x4, 0x6, 0xC, 0xB, 0x2, 0x5, 0x3,
	0x6, 0xC, 0x7, 0x1, 0x5, 0xF, 0xD, 0x8, 0x4, 0xA, 0x9, 0xE, 0x0, 0x3, 0xB, 0x2,
	0x4, 0xB, 0xA, 0x0, 0x7, 0x2, 0x1, 0xD, 0x3, 0x6, 0x8, 0x5, 0x9, 0xC, 0xF, 0xE,
	0xD, 0xB, 0x4, 0x1, 0x3, 0xF, 0x5, 0x9, 0x0, 0xA, 0xE, 0x7, 0x6, 0x8, 0x2, 0xC,
	0x1, 0xF, 0xD, 0x0, 0x5, 0x7, 0xA, 0x4, 0x9, 0x2, 0x3, 0xE, 0x6, 0xB, 0x8, 0xC,
}

//----------------------------------------------
// OID: 1.2.643.7.1.2.5.1.1
// Идентификатор: id-tc26-gost-28147-param-Z

var Table2 = []byte{
	0xC, 0x4, 0x6, 0x2, 0xA, 0x5, 0xB, 0x9, 0xE, 0x8, 0xD, 0x7, 0x0, 0x3, 0xF, 0x1,
	0x6, 0x8, 0x2, 0x3, 0x9, 0xA, 0x5, 0xC, 0x1, 0xE, 0x4, 0x7, 0xB, 0xD, 0x0, 0xF,
	0xB, 0x3, 0x5, 0x8, 0x2, 0xF, 0xA, 0xD, 0xE, 0x1, 0x7, 0x4, 0xC, 0x9, 0x6, 0x0,
	0xC, 0x8, 0x2, 0x1, 0xD, 0x4, 0xF, 0x6, 0x7, 0x0, 0xA, 0x5, 0x3, 0xE, 0x9, 0xB,
	0x7, 0xF, 0x5, 0xA, 0x8, 0x1, 0x6, 0xD, 0x0, 0x9, 0x3, 0xE, 0xB, 0x4, 0x2, 0xC,
	0x5, 0xD, 0xF, 0x6, 0x9, 0x2, 0xC, 0xA, 0xB, 0x7, 0x8, 0x1, 0x4, 0x3, 0xE, 0x0,
	0x8, 0xE, 0x2, 0x5, 0x6, 0x9, 0x1, 0xC, 0xF, 0x4, 0xB, 0x0, 0xD, 0xA, 0x3, 0x7,
	0x1, 0x7, 0xE, 0xD, 0x0, 0x5, 0x8, 0x3, 0x4, 0xF, 0xA, 0x6, 0x9, 0xC, 0xB, 0x2,
}
